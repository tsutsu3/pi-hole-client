import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:pi_hole_client/models/overtime_data.dart';
import 'package:pi_hole_client/screens/home/home_charts.dart';

import '../helpers.dart';

void main() async {
  await initializeApp();

  group(
    'HomeChart Screen Widget Tests',
    () {
      late TestSetupHelper testSetup;

      setUp(() async {
        testSetup = TestSetupHelper();

        testSetup.initializeMock(useApiGatewayVersion: 'v6');
      });

      testWidgets(
        'should show loading text when data is loading',
        (WidgetTester tester) async {
          tester.view.physicalSize = const Size(1080, 2400);
          tester.view.devicePixelRatio = 1.0;

          addTearDown(() {
            tester.view.resetPhysicalSize();
            tester.view.resetDevicePixelRatio();
          });

          when(testSetup.mockStatusProvider.getOvertimeDataLoadStatus)
              .thenReturn(0);

          await tester.pumpWidget(
            testSetup.buildTestWidget(
              const HomeCharts(),
            ),
          );

          expect(find.byType(HomeCharts), findsOneWidget);
          await tester.pump();
          expect(find.text('Loading charts...'), findsWidgets);
        },
      );

      testWidgets(
        'should show error text when error',
        (WidgetTester tester) async {
          tester.view.physicalSize = const Size(1080, 2400);
          tester.view.devicePixelRatio = 1.0;

          addTearDown(() {
            tester.view.resetPhysicalSize();
            tester.view.resetDevicePixelRatio();
          });

          when(testSetup.mockStatusProvider.getOvertimeDataLoadStatus)
              .thenReturn(2);

          await tester.pumpWidget(
            testSetup.buildTestWidget(
              const HomeCharts(),
            ),
          );

          expect(find.byType(HomeCharts), findsOneWidget);
          await tester.pump();
          expect(find.text('Charts could not be loaded'), findsWidgets);
        },
      );

      testWidgets(
        'should show queries graph and clients graph when data is loaded',
        (WidgetTester tester) async {
          tester.view.physicalSize = const Size(1080, 2400);
          tester.view.devicePixelRatio = 1.0;

          addTearDown(() {
            tester.view.resetPhysicalSize();
            tester.view.resetDevicePixelRatio();
          });

          await tester.pumpWidget(
            testSetup.buildTestWidget(
              const HomeCharts(),
            ),
          );

          expect(find.byType(HomeCharts), findsOneWidget);
          await tester.pump();

          expect(find.text('Total queries last 24 hours'), findsOneWidget);
          expect(find.text('Blocked'), findsOneWidget);
          expect(find.text('Not blocked'), findsOneWidget);

          expect(find.text('Client activity last 24 hours'), findsOneWidget);
          expect(find.text('172.26.0.1'), findsOneWidget);
          expect(find.text('127.0.0.1'), findsOneWidget);
          expect(find.text('localhost'), findsOneWidget);
        },
      );

      testWidgets(
        'should show queries graph and clients graph with permitted data only',
        (WidgetTester tester) async {
          tester.view.physicalSize = const Size(1080, 2400);
          tester.view.devicePixelRatio = 1.0;

          addTearDown(() {
            tester.view.resetPhysicalSize();
            tester.view.resetDevicePixelRatio();
          });

          final overtimeData = OverTimeData.fromJson(
            {
              'domains_over_time': {
                '1733391300': 0,
                '1733391900': 0,
                '1733392500': 0,
                '1733393100': 0,
                '1733393700': 0,
                '1733394300': 0,
                '1733394900': 0,
                '1733395500': 0,
                '1733396100': 0,
                '1733396700': 3,
                '1733397300': 0,
                '1733397900': 0,
                '1733398500': 0,
                '1733399100': 0,
                '1733399700': 0,
                '1733400300': 2,
                '1733400900': 7,
                '1733401500': 0,
                '1733402100': 0,
                '1733402700': 0,
                '1733403300': 0,
                '1733403900': 2,
                '1733404500': 0,
                '1733405100': 0,
                '1733405700': 0,
                '1733406300': 0,
                '1733406900': 0,
                '1733407500': 2,
                '1733408100': 0,
                '1733408700': 0,
                '1733409300': 0,
                '1733409900': 0,
                '1733410500': 0,
                '1733411100': 0,
                '1733411700': 0,
                '1733412300': 0,
                '1733412900': 0,
                '1733413500': 0,
                '1733414100': 0,
                '1733414700': 0,
                '1733415300': 0,
                '1733415900': 0,
                '1733416500': 0,
                '1733417100': 0,
                '1733417700': 0,
                '1733418300': 0,
                '1733418900': 0,
                '1733419500': 0,
                '1733420100': 0,
                '1733420700': 0,
                '1733421300': 0,
                '1733421900': 0,
                '1733422500': 0,
                '1733423100': 0,
                '1733423700': 0,
                '1733424300': 0,
                '1733424900': 0,
                '1733425500': 0,
                '1733426100': 0,
                '1733426700': 0,
                '1733427300': 0,
                '1733427900': 0,
                '1733428500': 0,
                '1733429100': 0,
                '1733429700': 0,
                '1733430300': 0,
                '1733430900': 0,
                '1733431500': 0,
                '1733432100': 0,
                '1733432700': 0,
                '1733433300': 0,
                '1733433900': 0,
                '1733434500': 0,
                '1733435100': 0,
                '1733435700': 0,
                '1733436300': 0,
                '1733436900': 0,
                '1733437500': 0,
                '1733438100': 0,
                '1733438700': 0,
                '1733439300': 0,
                '1733439900': 0,
                '1733440500': 0,
                '1733441100': 0,
                '1733441700': 0,
                '1733442300': 0,
                '1733442900': 0,
                '1733443500': 0,
                '1733444100': 0,
                '1733444700': 0,
                '1733445300': 0,
                '1733445900': 0,
                '1733446500': 0,
                '1733447100': 0,
                '1733447700': 0,
                '1733448300': 0,
                '1733448900': 0,
                '1733449500': 0,
                '1733450100': 0,
                '1733450700': 0,
                '1733451300': 0,
                '1733451900': 0,
                '1733452500': 0,
                '1733453100': 0,
                '1733453700': 0,
                '1733454300': 0,
                '1733454900': 0,
                '1733455500': 0,
                '1733456100': 0,
                '1733456700': 0,
                '1733457300': 0,
                '1733457900': 0,
                '1733458500': 0,
                '1733459100': 0,
                '1733459700': 0,
                '1733460300': 0,
                '1733460900': 0,
                '1733461500': 0,
                '1733462100': 0,
                '1733462700': 0,
                '1733463300': 0,
                '1733463900': 0,
                '1733464500': 0,
                '1733465100': 0,
                '1733465700': 0,
                '1733466300': 0,
                '1733466900': 0,
                '1733467500': 0,
                '1733468100': 0,
                '1733468700': 0,
                '1733469300': 0,
                '1733469900': 0,
                '1733470500': 0,
                '1733471100': 0,
                '1733471700': 0,
                '1733472300': 0,
                '1733472900': 0,
                '1733473500': 0,
                '1733474100': 0,
                '1733474700': 0,
                '1733475300': 0,
                '1733475900': 0,
                '1733476500': 0,
                '1733477100': 0,
              },
              'ads_over_time': {
                '1733391300': 0,
                '1733391900': 0,
                '1733392500': 0,
                '1733393100': 0,
                '1733393700': 0,
                '1733394300': 0,
                '1733394900': 0,
                '1733395500': 0,
                '1733396100': 0,
                '1733396700': 0,
                '1733397300': 0,
                '1733397900': 0,
                '1733398500': 0,
                '1733399100': 0,
                '1733399700': 0,
                '1733400300': 0,
                '1733400900': 0,
                '1733401500': 0,
                '1733402100': 0,
                '1733402700': 0,
                '1733403300': 0,
                '1733403900': 0,
                '1733404500': 0,
                '1733405100': 0,
                '1733405700': 0,
                '1733406300': 0,
                '1733406900': 0,
                '1733407500': 0,
                '1733408100': 0,
                '1733408700': 0,
                '1733409300': 0,
                '1733409900': 0,
                '1733410500': 0,
                '1733411100': 0,
                '1733411700': 0,
                '1733412300': 0,
                '1733412900': 0,
                '1733413500': 0,
                '1733414100': 0,
                '1733414700': 0,
                '1733415300': 0,
                '1733415900': 0,
                '1733416500': 0,
                '1733417100': 0,
                '1733417700': 0,
                '1733418300': 0,
                '1733418900': 0,
                '1733419500': 0,
                '1733420100': 0,
                '1733420700': 0,
                '1733421300': 0,
                '1733421900': 0,
                '1733422500': 0,
                '1733423100': 0,
                '1733423700': 0,
                '1733424300': 0,
                '1733424900': 0,
                '1733425500': 0,
                '1733426100': 0,
                '1733426700': 0,
                '1733427300': 0,
                '1733427900': 0,
                '1733428500': 0,
                '1733429100': 0,
                '1733429700': 0,
                '1733430300': 0,
                '1733430900': 0,
                '1733431500': 0,
                '1733432100': 0,
                '1733432700': 0,
                '1733433300': 0,
                '1733433900': 0,
                '1733434500': 0,
                '1733435100': 0,
                '1733435700': 0,
                '1733436300': 0,
                '1733436900': 0,
                '1733437500': 0,
                '1733438100': 0,
                '1733438700': 0,
                '1733439300': 0,
                '1733439900': 0,
                '1733440500': 0,
                '1733441100': 0,
                '1733441700': 0,
                '1733442300': 0,
                '1733442900': 0,
                '1733443500': 0,
                '1733444100': 0,
                '1733444700': 0,
                '1733445300': 0,
                '1733445900': 0,
                '1733446500': 0,
                '1733447100': 0,
                '1733447700': 0,
                '1733448300': 0,
                '1733448900': 0,
                '1733449500': 0,
                '1733450100': 0,
                '1733450700': 0,
                '1733451300': 0,
                '1733451900': 0,
                '1733452500': 0,
                '1733453100': 0,
                '1733453700': 0,
                '1733454300': 0,
                '1733454900': 0,
                '1733455500': 0,
                '1733456100': 0,
                '1733456700': 0,
                '1733457300': 0,
                '1733457900': 0,
                '1733458500': 0,
                '1733459100': 0,
                '1733459700': 0,
                '1733460300': 0,
                '1733460900': 0,
                '1733461500': 0,
                '1733462100': 0,
                '1733462700': 0,
                '1733463300': 0,
                '1733463900': 0,
                '1733464500': 0,
                '1733465100': 0,
                '1733465700': 0,
                '1733466300': 0,
                '1733466900': 0,
                '1733467500': 0,
                '1733468100': 0,
                '1733468700': 0,
                '1733469300': 0,
                '1733469900': 0,
                '1733470500': 0,
                '1733471100': 0,
                '1733471700': 0,
                '1733472300': 0,
                '1733472900': 0,
                '1733473500': 0,
                '1733474100': 0,
                '1733474700': 0,
                '1733475300': 0,
                '1733475900': 0,
                '1733476500': 0,
                '1733477100': 0,
              },
              'clients': [
                {'name': '', 'ip': '172.26.0.1'},
                {'name': 'localhost', 'ip': '127.0.0.1'},
              ],
              'over_time': {
                '1733391300': [0, 0],
                '1733391900': [0, 0],
                '1733392500': [0, 0],
                '1733393100': [0, 0],
                '1733393700': [0, 0],
                '1733394300': [0, 0],
                '1733394900': [0, 0],
                '1733395500': [0, 0],
                '1733396100': [0, 0],
                '1733396700': [3, 0],
                '1733397300': [0, 0],
                '1733397900': [0, 0],
                '1733398500': [0, 0],
                '1733399100': [0, 0],
                '1733399700': [0, 0],
                '1733400300': [0, 2],
                '1733400900': [7, 0],
                '1733401500': [0, 0],
                '1733402100': [0, 0],
                '1733402700': [0, 0],
                '1733403300': [0, 0],
                '1733403900': [0, 2],
                '1733404500': [0, 0],
                '1733405100': [0, 0],
                '1733405700': [0, 0],
                '1733406300': [0, 0],
                '1733406900': [0, 0],
                '1733407500': [0, 2],
                '1733408100': [0, 0],
                '1733408700': [0, 0],
                '1733409300': [0, 0],
                '1733409900': [0, 0],
                '1733410500': [0, 0],
                '1733411100': [0, 0],
                '1733411700': [0, 0],
                '1733412300': [0, 0],
                '1733412900': [0, 0],
                '1733413500': [0, 0],
                '1733414100': [0, 0],
                '1733414700': [0, 0],
                '1733415300': [0, 0],
                '1733415900': [0, 0],
                '1733416500': [0, 0],
                '1733417100': [0, 0],
                '1733417700': [0, 0],
                '1733418300': [0, 0],
                '1733418900': [0, 0],
                '1733419500': [0, 0],
                '1733420100': [0, 0],
                '1733420700': [0, 0],
                '1733421300': [0, 0],
                '1733421900': [0, 0],
                '1733422500': [0, 0],
                '1733423100': [0, 0],
                '1733423700': [0, 0],
                '1733424300': [0, 0],
                '1733424900': [0, 0],
                '1733425500': [0, 0],
                '1733426100': [0, 0],
                '1733426700': [0, 0],
                '1733427300': [0, 0],
                '1733427900': [0, 0],
                '1733428500': [0, 0],
                '1733429100': [0, 0],
                '1733429700': [0, 0],
                '1733430300': [0, 0],
                '1733430900': [0, 0],
                '1733431500': [0, 0],
                '1733432100': [0, 0],
                '1733432700': [0, 0],
                '1733433300': [0, 0],
                '1733433900': [0, 0],
                '1733434500': [0, 0],
                '1733435100': [0, 0],
                '1733435700': [0, 0],
                '1733436300': [0, 0],
                '1733436900': [0, 0],
                '1733437500': [0, 0],
                '1733438100': [0, 0],
                '1733438700': [0, 0],
                '1733439300': [0, 0],
                '1733439900': [0, 0],
                '1733440500': [0, 0],
                '1733441100': [0, 0],
                '1733441700': [0, 0],
                '1733442300': [0, 0],
                '1733442900': [0, 0],
                '1733443500': [0, 0],
                '1733444100': [0, 0],
                '1733444700': [0, 0],
                '1733445300': [0, 0],
                '1733445900': [0, 0],
                '1733446500': [0, 0],
                '1733447100': [0, 0],
                '1733447700': [0, 0],
                '1733448300': [0, 0],
                '1733448900': [0, 0],
                '1733449500': [0, 0],
                '1733450100': [0, 0],
                '1733450700': [0, 0],
                '1733451300': [0, 0],
                '1733451900': [0, 0],
                '1733452500': [0, 0],
                '1733453100': [0, 0],
                '1733453700': [0, 0],
                '1733454300': [0, 0],
                '1733454900': [0, 0],
                '1733455500': [0, 0],
                '1733456100': [0, 0],
                '1733456700': [0, 0],
                '1733457300': [0, 0],
                '1733457900': [0, 0],
                '1733458500': [0, 0],
                '1733459100': [0, 0],
                '1733459700': [0, 0],
                '1733460300': [0, 0],
                '1733460900': [0, 0],
                '1733461500': [0, 0],
                '1733462100': [0, 0],
                '1733462700': [0, 0],
                '1733463300': [0, 0],
                '1733463900': [0, 0],
                '1733464500': [0, 0],
                '1733465100': [0, 0],
                '1733465700': [0, 0],
                '1733466300': [0, 0],
                '1733466900': [0, 0],
                '1733467500': [0, 0],
                '1733468100': [0, 0],
                '1733468700': [0, 0],
                '1733469300': [0, 0],
                '1733469900': [0, 0],
                '1733470500': [0, 0],
                '1733471100': [0, 0],
                '1733471700': [0, 0],
                '1733472300': [0, 0],
                '1733472900': [0, 0],
                '1733473500': [0, 0],
                '1733474100': [0, 0],
                '1733474700': [0, 0],
                '1733475300': [0, 0],
                '1733475900': [0, 0],
                '1733476500': [0, 0],
                '1733477100': [0, 0],
              },
            },
          );

          when(testSetup.mockStatusProvider.getOvertimeData)
              .thenReturn(overtimeData);
          when(testSetup.mockStatusProvider.getOvertimeDataJson)
              .thenReturn(overtimeData.toJson());

          await tester.pumpWidget(
            testSetup.buildTestWidget(
              const HomeCharts(),
            ),
          );

          expect(find.byType(HomeCharts), findsOneWidget);
          await tester.pump();

          expect(find.text('Total queries last 24 hours'), findsOneWidget);
          expect(find.text('Blocked'), findsOneWidget);
          expect(find.text('Not blocked'), findsOneWidget);

          expect(find.text('Client activity last 24 hours'), findsOneWidget);
          expect(find.text('172.26.0.1'), findsOneWidget);
          expect(find.text('127.0.0.1'), findsOneWidget);
          expect(find.text('localhost'), findsOneWidget);
        },
      );

      testWidgets(
        'should show queries graph and clients graph with blocked data only',
        (WidgetTester tester) async {
          tester.view.physicalSize = const Size(1080, 2400);
          tester.view.devicePixelRatio = 1.0;

          addTearDown(() {
            tester.view.resetPhysicalSize();
            tester.view.resetDevicePixelRatio();
          });

          final overtimeData = OverTimeData.fromJson(
            {
              'domains_over_time': {
                '1733391300': 0,
                '1733391900': 0,
                '1733392500': 0,
                '1733393100': 0,
                '1733393700': 0,
                '1733394300': 0,
                '1733394900': 0,
                '1733395500': 0,
                '1733396100': 0,
                '1733396700': 0,
                '1733397300': 0,
                '1733397900': 0,
                '1733398500': 0,
                '1733399100': 0,
                '1733399700': 0,
                '1733400300': 0,
                '1733400900': 0,
                '1733401500': 0,
                '1733402100': 0,
                '1733402700': 0,
                '1733403300': 0,
                '1733403900': 0,
                '1733404500': 0,
                '1733405100': 0,
                '1733405700': 0,
                '1733406300': 0,
                '1733406900': 0,
                '1733407500': 0,
                '1733408100': 0,
                '1733408700': 0,
                '1733409300': 0,
                '1733409900': 0,
                '1733410500': 0,
                '1733411100': 0,
                '1733411700': 0,
                '1733412300': 0,
                '1733412900': 0,
                '1733413500': 0,
                '1733414100': 0,
                '1733414700': 0,
                '1733415300': 0,
                '1733415900': 0,
                '1733416500': 0,
                '1733417100': 0,
                '1733417700': 0,
                '1733418300': 0,
                '1733418900': 0,
                '1733419500': 0,
                '1733420100': 0,
                '1733420700': 0,
                '1733421300': 0,
                '1733421900': 0,
                '1733422500': 0,
                '1733423100': 0,
                '1733423700': 0,
                '1733424300': 0,
                '1733424900': 0,
                '1733425500': 0,
                '1733426100': 0,
                '1733426700': 0,
                '1733427300': 0,
                '1733427900': 0,
                '1733428500': 0,
                '1733429100': 0,
                '1733429700': 0,
                '1733430300': 0,
                '1733430900': 0,
                '1733431500': 0,
                '1733432100': 0,
                '1733432700': 0,
                '1733433300': 0,
                '1733433900': 0,
                '1733434500': 0,
                '1733435100': 0,
                '1733435700': 0,
                '1733436300': 0,
                '1733436900': 0,
                '1733437500': 0,
                '1733438100': 0,
                '1733438700': 0,
                '1733439300': 0,
                '1733439900': 0,
                '1733440500': 0,
                '1733441100': 0,
                '1733441700': 0,
                '1733442300': 0,
                '1733442900': 0,
                '1733443500': 0,
                '1733444100': 0,
                '1733444700': 0,
                '1733445300': 0,
                '1733445900': 0,
                '1733446500': 0,
                '1733447100': 0,
                '1733447700': 0,
                '1733448300': 0,
                '1733448900': 0,
                '1733449500': 0,
                '1733450100': 0,
                '1733450700': 0,
                '1733451300': 0,
                '1733451900': 0,
                '1733452500': 0,
                '1733453100': 0,
                '1733453700': 0,
                '1733454300': 0,
                '1733454900': 0,
                '1733455500': 0,
                '1733456100': 0,
                '1733456700': 0,
                '1733457300': 0,
                '1733457900': 0,
                '1733458500': 0,
                '1733459100': 0,
                '1733459700': 0,
                '1733460300': 0,
                '1733460900': 0,
                '1733461500': 0,
                '1733462100': 0,
                '1733462700': 0,
                '1733463300': 0,
                '1733463900': 0,
                '1733464500': 0,
                '1733465100': 0,
                '1733465700': 0,
                '1733466300': 0,
                '1733466900': 0,
                '1733467500': 0,
                '1733468100': 0,
                '1733468700': 0,
                '1733469300': 0,
                '1733469900': 0,
                '1733470500': 0,
                '1733471100': 0,
                '1733471700': 0,
                '1733472300': 0,
                '1733472900': 0,
                '1733473500': 0,
                '1733474100': 0,
                '1733474700': 0,
                '1733475300': 0,
                '1733475900': 0,
                '1733476500': 0,
                '1733477100': 0,
              },
              'ads_over_time': {
                '1733391300': 0,
                '1733391900': 0,
                '1733392500': 0,
                '1733393100': 0,
                '1733393700': 0,
                '1733394300': 0,
                '1733394900': 0,
                '1733395500': 0,
                '1733396100': 0,
                '1733396700': 0,
                '1733397300': 0,
                '1733397900': 0,
                '1733398500': 0,
                '1733399100': 0,
                '1733399700': 0,
                '1733400300': 0,
                '1733400900': 0,
                '1733401500': 0,
                '1733402100': 0,
                '1733402700': 0,
                '1733403300': 0,
                '1733403900': 0,
                '1733404500': 0,
                '1733405100': 0,
                '1733405700': 0,
                '1733406300': 0,
                '1733406900': 0,
                '1733407500': 0,
                '1733408100': 0,
                '1733408700': 0,
                '1733409300': 0,
                '1733409900': 0,
                '1733410500': 0,
                '1733411100': 0,
                '1733411700': 0,
                '1733412300': 0,
                '1733412900': 0,
                '1733413500': 0,
                '1733414100': 0,
                '1733414700': 0,
                '1733415300': 0,
                '1733415900': 0,
                '1733416500': 0,
                '1733417100': 0,
                '1733417700': 0,
                '1733418300': 0,
                '1733418900': 0,
                '1733419500': 0,
                '1733420100': 0,
                '1733420700': 0,
                '1733421300': 0,
                '1733421900': 0,
                '1733422500': 0,
                '1733423100': 0,
                '1733423700': 0,
                '1733424300': 0,
                '1733424900': 0,
                '1733425500': 0,
                '1733426100': 0,
                '1733426700': 0,
                '1733427300': 0,
                '1733427900': 0,
                '1733428500': 0,
                '1733429100': 0,
                '1733429700': 0,
                '1733430300': 0,
                '1733430900': 0,
                '1733431500': 0,
                '1733432100': 0,
                '1733432700': 0,
                '1733433300': 0,
                '1733433900': 0,
                '1733434500': 0,
                '1733435100': 0,
                '1733435700': 0,
                '1733436300': 0,
                '1733436900': 0,
                '1733437500': 0,
                '1733438100': 0,
                '1733438700': 0,
                '1733439300': 0,
                '1733439900': 0,
                '1733440500': 0,
                '1733441100': 0,
                '1733441700': 0,
                '1733442300': 0,
                '1733442900': 0,
                '1733443500': 0,
                '1733444100': 0,
                '1733444700': 0,
                '1733445300': 0,
                '1733445900': 0,
                '1733446500': 0,
                '1733447100': 0,
                '1733447700': 0,
                '1733448300': 0,
                '1733448900': 0,
                '1733449500': 0,
                '1733450100': 0,
                '1733450700': 0,
                '1733451300': 0,
                '1733451900': 0,
                '1733452500': 0,
                '1733453100': 0,
                '1733453700': 0,
                '1733454300': 0,
                '1733454900': 0,
                '1733455500': 0,
                '1733456100': 0,
                '1733456700': 0,
                '1733457300': 0,
                '1733457900': 0,
                '1733458500': 0,
                '1733459100': 0,
                '1733459700': 0,
                '1733460300': 0,
                '1733460900': 0,
                '1733461500': 0,
                '1733462100': 0,
                '1733462700': 0,
                '1733463300': 0,
                '1733463900': 0,
                '1733464500': 0,
                '1733465100': 0,
                '1733465700': 0,
                '1733466300': 0,
                '1733466900': 0,
                '1733467500': 0,
                '1733468100': 0,
                '1733468700': 0,
                '1733469300': 0,
                '1733469900': 0,
                '1733470500': 0,
                '1733471100': 0,
                '1733471700': 0,
                '1733472300': 0,
                '1733472900': 0,
                '1733473500': 0,
                '1733474100': 0,
                '1733474700': 0,
                '1733475300': 0,
                '1733475900': 1,
                '1733476500': 1,
                '1733477100': 1,
              },
              'clients': [
                {'name': '', 'ip': '172.26.0.1'},
                {'name': 'localhost', 'ip': '127.0.0.1'},
              ],
              'over_time': {
                '1733391300': [0, 0],
                '1733391900': [0, 0],
                '1733392500': [0, 0],
                '1733393100': [0, 0],
                '1733393700': [0, 0],
                '1733394300': [0, 0],
                '1733394900': [0, 0],
                '1733395500': [0, 0],
                '1733396100': [0, 0],
                '1733396700': [0, 0],
                '1733397300': [0, 0],
                '1733397900': [0, 0],
                '1733398500': [0, 0],
                '1733399100': [0, 0],
                '1733399700': [0, 0],
                '1733400300': [0, 0],
                '1733400900': [0, 0],
                '1733401500': [0, 0],
                '1733402100': [0, 0],
                '1733402700': [0, 0],
                '1733403300': [0, 0],
                '1733403900': [0, 0],
                '1733404500': [0, 0],
                '1733405100': [0, 0],
                '1733405700': [0, 0],
                '1733406300': [0, 0],
                '1733406900': [0, 0],
                '1733407500': [0, 0],
                '1733408100': [0, 0],
                '1733408700': [0, 0],
                '1733409300': [0, 0],
                '1733409900': [0, 0],
                '1733410500': [0, 0],
                '1733411100': [0, 0],
                '1733411700': [0, 0],
                '1733412300': [0, 0],
                '1733412900': [0, 0],
                '1733413500': [0, 0],
                '1733414100': [0, 0],
                '1733414700': [0, 0],
                '1733415300': [0, 0],
                '1733415900': [0, 0],
                '1733416500': [0, 0],
                '1733417100': [0, 0],
                '1733417700': [0, 0],
                '1733418300': [0, 0],
                '1733418900': [0, 0],
                '1733419500': [0, 0],
                '1733420100': [0, 0],
                '1733420700': [0, 0],
                '1733421300': [0, 0],
                '1733421900': [0, 0],
                '1733422500': [0, 0],
                '1733423100': [0, 0],
                '1733423700': [0, 0],
                '1733424300': [0, 0],
                '1733424900': [0, 0],
                '1733425500': [0, 0],
                '1733426100': [0, 0],
                '1733426700': [0, 0],
                '1733427300': [0, 0],
                '1733427900': [0, 0],
                '1733428500': [0, 0],
                '1733429100': [0, 0],
                '1733429700': [0, 0],
                '1733430300': [0, 0],
                '1733430900': [0, 0],
                '1733431500': [0, 0],
                '1733432100': [0, 0],
                '1733432700': [0, 0],
                '1733433300': [0, 0],
                '1733433900': [0, 0],
                '1733434500': [0, 0],
                '1733435100': [0, 0],
                '1733435700': [0, 0],
                '1733436300': [0, 0],
                '1733436900': [0, 0],
                '1733437500': [0, 0],
                '1733438100': [0, 0],
                '1733438700': [0, 0],
                '1733439300': [0, 0],
                '1733439900': [0, 0],
                '1733440500': [0, 0],
                '1733441100': [0, 0],
                '1733441700': [0, 0],
                '1733442300': [0, 0],
                '1733442900': [0, 0],
                '1733443500': [0, 0],
                '1733444100': [0, 0],
                '1733444700': [0, 0],
                '1733445300': [0, 0],
                '1733445900': [0, 0],
                '1733446500': [0, 0],
                '1733447100': [0, 0],
                '1733447700': [0, 0],
                '1733448300': [0, 0],
                '1733448900': [0, 0],
                '1733449500': [0, 0],
                '1733450100': [0, 0],
                '1733450700': [0, 0],
                '1733451300': [0, 0],
                '1733451900': [0, 0],
                '1733452500': [0, 0],
                '1733453100': [0, 0],
                '1733453700': [0, 0],
                '1733454300': [0, 0],
                '1733454900': [0, 0],
                '1733455500': [0, 0],
                '1733456100': [0, 0],
                '1733456700': [0, 0],
                '1733457300': [0, 0],
                '1733457900': [0, 0],
                '1733458500': [0, 0],
                '1733459100': [0, 0],
                '1733459700': [0, 0],
                '1733460300': [0, 0],
                '1733460900': [0, 0],
                '1733461500': [0, 0],
                '1733462100': [0, 0],
                '1733462700': [0, 0],
                '1733463300': [0, 0],
                '1733463900': [0, 0],
                '1733464500': [0, 0],
                '1733465100': [0, 0],
                '1733465700': [0, 0],
                '1733466300': [0, 0],
                '1733466900': [0, 0],
                '1733467500': [0, 0],
                '1733468100': [0, 0],
                '1733468700': [0, 0],
                '1733469300': [0, 0],
                '1733469900': [0, 0],
                '1733470500': [0, 0],
                '1733471100': [0, 0],
                '1733471700': [0, 0],
                '1733472300': [0, 0],
                '1733472900': [0, 0],
                '1733473500': [0, 0],
                '1733474100': [0, 0],
                '1733474700': [0, 0],
                '1733475300': [0, 0],
                '1733475900': [1, 0],
                '1733476500': [1, 0],
                '1733477100': [0, 1],
              },
            },
          );

          when(testSetup.mockStatusProvider.getOvertimeData)
              .thenReturn(overtimeData);
          when(testSetup.mockStatusProvider.getOvertimeDataJson)
              .thenReturn(overtimeData.toJson());

          await tester.pumpWidget(
            testSetup.buildTestWidget(
              const HomeCharts(),
            ),
          );

          expect(find.byType(HomeCharts), findsOneWidget);
          await tester.pump();

          expect(find.text('Total queries last 24 hours'), findsOneWidget);
          expect(find.text('Blocked'), findsOneWidget);
          expect(find.text('Not blocked'), findsOneWidget);

          expect(find.text('Client activity last 24 hours'), findsOneWidget);
          expect(find.text('172.26.0.1'), findsOneWidget);
          expect(find.text('127.0.0.1'), findsOneWidget);
          expect(find.text('localhost'), findsOneWidget);
        },
      );

      testWidgets(
        'should show nodata text when no data is available',
        (WidgetTester tester) async {
          tester.view.physicalSize = const Size(1080, 2400);
          tester.view.devicePixelRatio = 1.0;

          addTearDown(() {
            tester.view.resetPhysicalSize();
            tester.view.resetDevicePixelRatio();
          });

          final overtimeData = OverTimeData.fromJson(
            {
              'domains_over_time': {
                '1733391300': 0,
                '1733391900': 0,
                '1733392500': 0,
                '1733393100': 0,
                '1733393700': 0,
                '1733394300': 0,
                '1733394900': 0,
                '1733395500': 0,
                '1733396100': 0,
                '1733396700': 0,
                '1733397300': 0,
                '1733397900': 0,
                '1733398500': 0,
                '1733399100': 0,
                '1733399700': 0,
                '1733400300': 0,
                '1733400900': 0,
                '1733401500': 0,
                '1733402100': 0,
                '1733402700': 0,
                '1733403300': 0,
                '1733403900': 0,
                '1733404500': 0,
                '1733405100': 0,
                '1733405700': 0,
                '1733406300': 0,
                '1733406900': 0,
                '1733407500': 0,
                '1733408100': 0,
                '1733408700': 0,
                '1733409300': 0,
                '1733409900': 0,
                '1733410500': 0,
                '1733411100': 0,
                '1733411700': 0,
                '1733412300': 0,
                '1733412900': 0,
                '1733413500': 0,
                '1733414100': 0,
                '1733414700': 0,
                '1733415300': 0,
                '1733415900': 0,
                '1733416500': 0,
                '1733417100': 0,
                '1733417700': 0,
                '1733418300': 0,
                '1733418900': 0,
                '1733419500': 0,
                '1733420100': 0,
                '1733420700': 0,
                '1733421300': 0,
                '1733421900': 0,
                '1733422500': 0,
                '1733423100': 0,
                '1733423700': 0,
                '1733424300': 0,
                '1733424900': 0,
                '1733425500': 0,
                '1733426100': 0,
                '1733426700': 0,
                '1733427300': 0,
                '1733427900': 0,
                '1733428500': 0,
                '1733429100': 0,
                '1733429700': 0,
                '1733430300': 0,
                '1733430900': 0,
                '1733431500': 0,
                '1733432100': 0,
                '1733432700': 0,
                '1733433300': 0,
                '1733433900': 0,
                '1733434500': 0,
                '1733435100': 0,
                '1733435700': 0,
                '1733436300': 0,
                '1733436900': 0,
                '1733437500': 0,
                '1733438100': 0,
                '1733438700': 0,
                '1733439300': 0,
                '1733439900': 0,
                '1733440500': 0,
                '1733441100': 0,
                '1733441700': 0,
                '1733442300': 0,
                '1733442900': 0,
                '1733443500': 0,
                '1733444100': 0,
                '1733444700': 0,
                '1733445300': 0,
                '1733445900': 0,
                '1733446500': 0,
                '1733447100': 0,
                '1733447700': 0,
                '1733448300': 0,
                '1733448900': 0,
                '1733449500': 0,
                '1733450100': 0,
                '1733450700': 0,
                '1733451300': 0,
                '1733451900': 0,
                '1733452500': 0,
                '1733453100': 0,
                '1733453700': 0,
                '1733454300': 0,
                '1733454900': 0,
                '1733455500': 0,
                '1733456100': 0,
                '1733456700': 0,
                '1733457300': 0,
                '1733457900': 0,
                '1733458500': 0,
                '1733459100': 0,
                '1733459700': 0,
                '1733460300': 0,
                '1733460900': 0,
                '1733461500': 0,
                '1733462100': 0,
                '1733462700': 0,
                '1733463300': 0,
                '1733463900': 0,
                '1733464500': 0,
                '1733465100': 0,
                '1733465700': 0,
                '1733466300': 0,
                '1733466900': 0,
                '1733467500': 0,
                '1733468100': 0,
                '1733468700': 0,
                '1733469300': 0,
                '1733469900': 0,
                '1733470500': 0,
                '1733471100': 0,
                '1733471700': 0,
                '1733472300': 0,
                '1733472900': 0,
                '1733473500': 0,
                '1733474100': 0,
                '1733474700': 0,
                '1733475300': 0,
                '1733475900': 0,
                '1733476500': 0,
                '1733477100': 0,
              },
              'ads_over_time': {
                '1733391300': 0,
                '1733391900': 0,
                '1733392500': 0,
                '1733393100': 0,
                '1733393700': 0,
                '1733394300': 0,
                '1733394900': 0,
                '1733395500': 0,
                '1733396100': 0,
                '1733396700': 0,
                '1733397300': 0,
                '1733397900': 0,
                '1733398500': 0,
                '1733399100': 0,
                '1733399700': 0,
                '1733400300': 0,
                '1733400900': 0,
                '1733401500': 0,
                '1733402100': 0,
                '1733402700': 0,
                '1733403300': 0,
                '1733403900': 0,
                '1733404500': 0,
                '1733405100': 0,
                '1733405700': 0,
                '1733406300': 0,
                '1733406900': 0,
                '1733407500': 0,
                '1733408100': 0,
                '1733408700': 0,
                '1733409300': 0,
                '1733409900': 0,
                '1733410500': 0,
                '1733411100': 0,
                '1733411700': 0,
                '1733412300': 0,
                '1733412900': 0,
                '1733413500': 0,
                '1733414100': 0,
                '1733414700': 0,
                '1733415300': 0,
                '1733415900': 0,
                '1733416500': 0,
                '1733417100': 0,
                '1733417700': 0,
                '1733418300': 0,
                '1733418900': 0,
                '1733419500': 0,
                '1733420100': 0,
                '1733420700': 0,
                '1733421300': 0,
                '1733421900': 0,
                '1733422500': 0,
                '1733423100': 0,
                '1733423700': 0,
                '1733424300': 0,
                '1733424900': 0,
                '1733425500': 0,
                '1733426100': 0,
                '1733426700': 0,
                '1733427300': 0,
                '1733427900': 0,
                '1733428500': 0,
                '1733429100': 0,
                '1733429700': 0,
                '1733430300': 0,
                '1733430900': 0,
                '1733431500': 0,
                '1733432100': 0,
                '1733432700': 0,
                '1733433300': 0,
                '1733433900': 0,
                '1733434500': 0,
                '1733435100': 0,
                '1733435700': 0,
                '1733436300': 0,
                '1733436900': 0,
                '1733437500': 0,
                '1733438100': 0,
                '1733438700': 0,
                '1733439300': 0,
                '1733439900': 0,
                '1733440500': 0,
                '1733441100': 0,
                '1733441700': 0,
                '1733442300': 0,
                '1733442900': 0,
                '1733443500': 0,
                '1733444100': 0,
                '1733444700': 0,
                '1733445300': 0,
                '1733445900': 0,
                '1733446500': 0,
                '1733447100': 0,
                '1733447700': 0,
                '1733448300': 0,
                '1733448900': 0,
                '1733449500': 0,
                '1733450100': 0,
                '1733450700': 0,
                '1733451300': 0,
                '1733451900': 0,
                '1733452500': 0,
                '1733453100': 0,
                '1733453700': 0,
                '1733454300': 0,
                '1733454900': 0,
                '1733455500': 0,
                '1733456100': 0,
                '1733456700': 0,
                '1733457300': 0,
                '1733457900': 0,
                '1733458500': 0,
                '1733459100': 0,
                '1733459700': 0,
                '1733460300': 0,
                '1733460900': 0,
                '1733461500': 0,
                '1733462100': 0,
                '1733462700': 0,
                '1733463300': 0,
                '1733463900': 0,
                '1733464500': 0,
                '1733465100': 0,
                '1733465700': 0,
                '1733466300': 0,
                '1733466900': 0,
                '1733467500': 0,
                '1733468100': 0,
                '1733468700': 0,
                '1733469300': 0,
                '1733469900': 0,
                '1733470500': 0,
                '1733471100': 0,
                '1733471700': 0,
                '1733472300': 0,
                '1733472900': 0,
                '1733473500': 0,
                '1733474100': 0,
                '1733474700': 0,
                '1733475300': 0,
                '1733475900': 0,
                '1733476500': 0,
                '1733477100': 0,
              },
              'clients': [],
              'over_time': {
                '1733391300': [0, 0],
                '1733391900': [0, 0],
                '1733392500': [0, 0],
                '1733393100': [0, 0],
                '1733393700': [0, 0],
                '1733394300': [0, 0],
                '1733394900': [0, 0],
                '1733395500': [0, 0],
                '1733396100': [0, 0],
                '1733396700': [0, 0],
                '1733397300': [0, 0],
                '1733397900': [0, 0],
                '1733398500': [0, 0],
                '1733399100': [0, 0],
                '1733399700': [0, 0],
                '1733400300': [0, 0],
                '1733400900': [0, 0],
                '1733401500': [0, 0],
                '1733402100': [0, 0],
                '1733402700': [0, 0],
                '1733403300': [0, 0],
                '1733403900': [0, 0],
                '1733404500': [0, 0],
                '1733405100': [0, 0],
                '1733405700': [0, 0],
                '1733406300': [0, 0],
                '1733406900': [0, 0],
                '1733407500': [0, 0],
                '1733408100': [0, 0],
                '1733408700': [0, 0],
                '1733409300': [0, 0],
                '1733409900': [0, 0],
                '1733410500': [0, 0],
                '1733411100': [0, 0],
                '1733411700': [0, 0],
                '1733412300': [0, 0],
                '1733412900': [0, 0],
                '1733413500': [0, 0],
                '1733414100': [0, 0],
                '1733414700': [0, 0],
                '1733415300': [0, 0],
                '1733415900': [0, 0],
                '1733416500': [0, 0],
                '1733417100': [0, 0],
                '1733417700': [0, 0],
                '1733418300': [0, 0],
                '1733418900': [0, 0],
                '1733419500': [0, 0],
                '1733420100': [0, 0],
                '1733420700': [0, 0],
                '1733421300': [0, 0],
                '1733421900': [0, 0],
                '1733422500': [0, 0],
                '1733423100': [0, 0],
                '1733423700': [0, 0],
                '1733424300': [0, 0],
                '1733424900': [0, 0],
                '1733425500': [0, 0],
                '1733426100': [0, 0],
                '1733426700': [0, 0],
                '1733427300': [0, 0],
                '1733427900': [0, 0],
                '1733428500': [0, 0],
                '1733429100': [0, 0],
                '1733429700': [0, 0],
                '1733430300': [0, 0],
                '1733430900': [0, 0],
                '1733431500': [0, 0],
                '1733432100': [0, 0],
                '1733432700': [0, 0],
                '1733433300': [0, 0],
                '1733433900': [0, 0],
                '1733434500': [0, 0],
                '1733435100': [0, 0],
                '1733435700': [0, 0],
                '1733436300': [0, 0],
                '1733436900': [0, 0],
                '1733437500': [0, 0],
                '1733438100': [0, 0],
                '1733438700': [0, 0],
                '1733439300': [0, 0],
                '1733439900': [0, 0],
                '1733440500': [0, 0],
                '1733441100': [0, 0],
                '1733441700': [0, 0],
                '1733442300': [0, 0],
                '1733442900': [0, 0],
                '1733443500': [0, 0],
                '1733444100': [0, 0],
                '1733444700': [0, 0],
                '1733445300': [0, 0],
                '1733445900': [0, 0],
                '1733446500': [0, 0],
                '1733447100': [0, 0],
                '1733447700': [0, 0],
                '1733448300': [0, 0],
                '1733448900': [0, 0],
                '1733449500': [0, 0],
                '1733450100': [0, 0],
                '1733450700': [0, 0],
                '1733451300': [0, 0],
                '1733451900': [0, 0],
                '1733452500': [0, 0],
                '1733453100': [0, 0],
                '1733453700': [0, 0],
                '1733454300': [0, 0],
                '1733454900': [0, 0],
                '1733455500': [0, 0],
                '1733456100': [0, 0],
                '1733456700': [0, 0],
                '1733457300': [0, 0],
                '1733457900': [0, 0],
                '1733458500': [0, 0],
                '1733459100': [0, 0],
                '1733459700': [0, 0],
                '1733460300': [0, 0],
                '1733460900': [0, 0],
                '1733461500': [0, 0],
                '1733462100': [0, 0],
                '1733462700': [0, 0],
                '1733463300': [0, 0],
                '1733463900': [0, 0],
                '1733464500': [0, 0],
                '1733465100': [0, 0],
                '1733465700': [0, 0],
                '1733466300': [0, 0],
                '1733466900': [0, 0],
                '1733467500': [0, 0],
                '1733468100': [0, 0],
                '1733468700': [0, 0],
                '1733469300': [0, 0],
                '1733469900': [0, 0],
                '1733470500': [0, 0],
                '1733471100': [0, 0],
                '1733471700': [0, 0],
                '1733472300': [0, 0],
                '1733472900': [0, 0],
                '1733473500': [0, 0],
                '1733474100': [0, 0],
                '1733474700': [0, 0],
                '1733475300': [0, 0],
                '1733475900': [0, 0],
                '1733476500': [0, 0],
                '1733477100': [0, 0],
              },
            },
          );

          when(testSetup.mockStatusProvider.getOvertimeData)
              .thenReturn(overtimeData);
          when(testSetup.mockStatusProvider.getOvertimeDataJson)
              .thenReturn(overtimeData.toJson());

          await tester.pumpWidget(
            testSetup.buildTestWidget(
              const HomeCharts(),
            ),
          );

          expect(find.byType(HomeCharts), findsOneWidget);
          await tester.pump();

          expect(find.text('Total queries last 24 hours'), findsOneWidget);
          expect(find.text('Client activity last 24 hours'), findsOneWidget);
          expect(find.text('No data'), findsNWidgets(2));
        },
      );
    },
  );
}
